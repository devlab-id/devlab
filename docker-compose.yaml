version: '3.8'

services:
  coolify:
    image: coollabsio/coolify:${TAG:-latest}
    restart: always
    container_name: coolify
    ports:
      - target: 3000
        published: 3000
        protocol: tcp
        mode: host
    volumes:
      - 'coolify-db:/app/db'
      - 'coolify-ssl-certs:/app/ssl'
      - 'coolify-traefik-letsencrypt:/etc/traefik/acme'
      - 'coolify-letsencrypt:/etc/letsencrypt'
      - '/var/run/docker.sock:/var/run/docker.sock'
    env_file:
      - '.env'
    networks:
      - coolify-infra
  # postgres:
  #   image: postgres:14.5-alpine
  #   restart: always
  #   container_name: coolify-pg
  #   command:
  #     - "postgres"
  #     - "-c"
  #     - "log_connections=yes"
  #     - "-c"
  #     - "max_connections=1337"
  #   volumes:
  #     - 'coolify-pgdb:/var/lib/postgresql/data'
  #   ports:
  #     - target: 5432
  #       published: 5432
  #       protocol: tcp
networks:
  coolify-infra:
    attachable: true
    name: coolify-infra

volumes:
  coolify-db:
    name: coolify-db
  coolify-pgdb:
    name: coolify-pgdb
  coolify-ssl-certs:
    name: coolify-ssl-certs
  coolify-letsencrypt:
    name: coolify-letsencrypt
  coolify-traefik-letsencrypt:
    name: coolify-traefik-letsencrypt
